# 敏捷&迭代： 走在精益开发的路上
敏捷与迭代是两个非常大的课题。窃以为，通过实践的过程，逐步剖析。防止理论过于空洞，因此我采用自底向上的方法以开发的实际过程为切入点进行介绍。欢迎大家一起交流。
    
## 简要介绍一下当前开发的流程

![](./../image/CI.png)


具体说来：
* 项目的初期，由系统专家将整个开发过程划分成若干迭代，每个迭代一般为4周。在一个迭代中，由若干Story组成。
* 对于每一个开发者来说，在自己的云上完成迭代任务的需求澄清，分析文档及代码后，将代码推送到开发服务器上，进行编译链接，产生新的版本
* 开发者使用自己编译出的版本进行本地测试
* 验证后，开发者将代码推送到Git/Gerrit服务器， 该服务器提供两类服务：一是进行代码的评审，构建结果信息展示；二是代码托管
* 开发者将代码上传到GIT服务器后， 再触发构建命令
* 构建时，CI Jenkins的Master机器通过首先check out一份代码，并通过动态管理技术，在不同的Slave机器上执行不同的任务（编译任务， Pclint检查任务，圈复杂度检查，fortify&coverity任务， UT/ST工程任务等）
* 待所有任务均执行完后，将执行的结果汇总到Jenkins Master机器，并发送到Gerrit服务器，便于开发者及代码检视者看到构建的结果
* 如果构建成功，将会把构建出的版本上传到版本服务器

## 开发工具
### GIT
[GIT](https://git-scm.com/)由Linus开发，在Linux内核开发的过程中，起到非常大的作用。它是一个非常优秀的免费的分布式版本控制工具。与其他版本管理工具不同的是，GIT的每一个副本均是代码仓的完整拷贝。

    
### Repo (Repository)
AOSP (Android Open Source Project)是由众多的代码仓组成的。 Google为了更方便地管理这些代码仓，使用Python开发的一套工具。


### Gerrit
Gerrit是Google为AOSP开发的一款免费的开源的代码检视工具。

Python创始人Guido van Rossum开发了Rietveld工具用于Google的云服务项目的代码检视。 但是由于此工具缺少ACL的支持。它们基于Rietveld项目，进行二次开发，即为Gerrit。其中[Gerrit Rietveld](https://en.wikipedia.org/wiki/Gerrit_Rietveld)是荷兰著名的设计师。


### Jenkins

Jenkins project was forked from Hudson after a dispute with Oracle.

Jenkins is an open source automation server written in Java. Jenkins 
helps to automate the non-human part of software development process

## 敏捷与迭代
2006年4月开始，公司在XXXX项目上开始试点敏捷开发。随后，开始推广，截至到目前，内部绝大多数的项目均是采用敏捷开发方法。 那么我们需要回答三个问题：
* 为什么使用敏捷开发方法，其价值体现在哪里？
* 我们的问题是什么？
* 是否能进一步提升产品质量，提高客户满意度，降低研发成本？

### 什么是敏捷开发

在早些年，一般采用计划驱动的方式开发产品，即，要有详细的需求文档，项目计划，立项申请等。但近些年，这种计划驱动无法应对快速的软件需求变更，无法及时提供客户满意的产品。 因此，有人提出了一系列的方法，如DSDM，FDD（Feature-Driven Development），XP(eXtreme Programming)，ASD(Adaptive Software Development)，Scrum等。

2001年2月11日到13日，17位软件开发领域的领军人物聚集在美国犹他州的滑雪胜地雪鸟（Snowbird）雪场。经过两天的讨论，“敏捷”（Agile）这个词为全体聚会者所接受，用以概括一套全新的软件开发价值观。这套价值观，通过一份简明扼要的《敏捷宣言》传递给世界，同时即宣告了敏捷开发运动的开始。

#### 《敏捷宣言》

我们通过身体力行和帮助他人来揭示更好的软件开发方式。经由这项工作，我们形成了如下价值观：

**个体与交互 重于 过程和工具**

人是获得成功的最为重要的因素。一个优秀的团队，其成员具有良好的沟通与合作能力。合适的工具对于成功来说也非常重要。如编译器，IDE，源代码控制系统等。但是工具的作用不能过分夸大。

而且，团队的构建要比环境的构建更为重要。

**可用的软件 重于 完备的文档**

没有文档是软件的一大灾难，代码不是传达系统原理和结构的理想媒介。团队需要编制易于理解的文档。但是过多的文档比过少的文档更糟糕。众多的文档不仅浪费时间，而且要使这些文档与代码同步，需要花费更多的时间。

对于一个团队来说，编写并维护一份系统原理和结构方面的文档将是一个好主意。但是这份文档应该是短小的并且主题突出（论述系统的高层结构和概括的设计原理）。

Martin文档第一定律：直到迫切需要并且意义重大时，才来编制文档

**客户协作   重于 合同谈判**

成功的项目需要有序、频繁的客户反馈。不是依赖于合同或者关于工作的陈述，而是让软件的客户和开发团队密切地在一起工作，并尽量经常地提供反馈。

**响应变化   重于 遵循计划**

响应变化的能力常常决定着一个软件项目的成败。当我们构建计划时，应该确保计划是灵活的并且易于适应商务和技术方面的变化。

较好的做计划的策略是：为下两周做详细的计划，为下三个月做粗略的计划，再以后就做极为粗糙的计划。
虽然右项也具有价值，

但我们认为左项具有更大的价值

17位敏捷宣言发起人名单如下：

**Kent Beck; Mike Beedle; Arie van Bennekum; Alistair Cockburn;**

**Ward Cunningham; Martin Fowle; James Grenning; Jim Highsmith;**

**Andrew Hunt; Ron Jeffries; Jon Kern; Brian Marick;**

**Robert C. Martin; Steve Mellor; Ken Schwaber; Jeff Sutherland;**

**Dave Thomas**

#### 敏捷开发十二原则

在敏捷开发中，我们遵循以下准则：

* 我们的最高目标是，通过尽早和持续地交付有价值的软件来满足客户。
* 欢迎对需求提出变更——即使是在项目开发后期。要善于利用需求变更，帮助客户获得竞争优势。
* 要不断交付可用的软件，周期从几周到几个月不等，且越短越好。
* 项目过程中，业务人员与开发人员必须在一起工作。
* 要善于激励项目人员，给他们以所需要的环境和支持，并相信他们能够完成任务。
* 无论是团队内还是团队间，最有效的沟通方法是面对面的交谈。
* 可用的软件是衡量进度的主要指标。
* 敏捷过程提倡可持续的开发。项目方、开发人员和用户应该能够保持恒久稳定的进展速度。
* 对技术的精益求精以及对设计的不断完善将提升敏捷性。
* 要做到简洁，即尽最大可能减少不必要的工作。这是一门艺术。
* 最佳的架构、需求和设计出自于自组织的团队。
* 团队要定期反省如何能够做到更有效，并相应地调整团队的行为。

### 什么是迭代
瀑布开发与迭代开发均是产品开发的生命周期模型。

瀑布开发方法强调单次遍历，串行，以文档驱动。

而迭代开发是通过将项目划分成多个子迭代，渐增式的开发。在每一个子迭代中，包含多个开发Stroy。而每个stroy含有需求分析，软件设计，编码，测试等几个活动。需要注意地是，这些活动并非串行开展，迭代不是若干个小瀑布的迭加。

在每次迭代结束后，将产生一个迭代版本（也可以说是部分完成的系统），它是稳定且被测试过的。因为每次迭代总有新功能的增加。所以也叫递增开发。通过迭代使系统增长的方式称为迭代递增开发(Iterative and Incremental development, IID)，通常也叫迭代开发。

通过一次次的迭代和发布，项目进入一种可以预测的、舒适地开发节奏。每个人都知道将要做什么，以及何时去做。

这两种开发模式都各自具有自己的特点，迭代式开发适合在一些需求信息不明确的项目中，这样在开发过程中遇到需求的变化时，所带来的影响要比瀑布式开发小。而现在的很多项目中，需求在项目进行中变化的事儿经常见，所以显得迭代式开发的优势更明显一些。

总体来说，迭代开发可以：

* 对于开发人员来说，他们可以基于自己的估算并且由他们自己度量的开发速度控制合理的计划。并保持高的工作质量；

* 对于管理人员从每次迭代中获取数据，他们使用这些数据来控制和管理项目。

* 对于客户来说，我们不用再看到图，及写满计划的记事本，他们接触到的是一个可以工作的软件，并且可以根据此软件提供反馈。当然这并不意味着可以立刻得到他们想要的结果，尤其在迭代开发初期。它只不过是意味着他们将能够控制着团队以最小的代价获得更大的商业价值。

### 敏捷与迭代
 迭代开发是一种软件开发的生命周期模型,与其对应的还有瀑布模型、螺旋模型等等

敏捷开发是多种**软件开发项目管理方法**的集合,其中包括了XP、Scrum等十几种开发模式,这些开发方法有些共同点,比如重视响应变更,重视实现客户的价值,重视开发人员的自身发展等等,其核心体现在他们著名的四句原则中.这些开发方法基本都倾向于采用迭代的软件开发生命周期模型.

简单来说,迭代模型是敏捷开发普遍使用的软件生命周期模型,敏捷开发所包含的内容比迭代模型宽泛的多.

### XP与Scrum

* 区别之一：  迭代长度的不同

XP的一个Sprint的迭代长度大致为1~2周, 而Scrum的迭代长度一般为 2~ 4周.

* 区别之二: 在迭代中, 是否允许修改需求

XP在一个迭代中，如果一个User Story(用户素材, 也就是一个需求)还没有实现， 则可以考虑用另外的需求将其替换， 替换的原则是需求实现的时间量是相等的。 而Scrum是不允许这样做的，一旦迭代开工会完毕, 任何需求都不允许添加进来，并有Scrum Master严格把关，不允许开发团队收到干扰

* 区别之三: 在迭代中，User Story是否严格按照优先级别来实现

XP是务必要遵守优先级别的。 但Scrum在这点做得很灵活， 可以不按照优先级别来做，Scrum这样处理的理由是： 如果优先问题的解决者，由于其它事情耽搁，不能认领任务，那么整个进度就耽误了。 另外一个原因是，如果按优先级排序的User Story #6和#10，虽然#6优先级高，但是如果#6的实现要依赖于#10，则不得不优先做#10.

* 区别之四: 软件的实施过程中，是否采用严格的工程方法，保证进度或者质量

Scrum没有对软件的整个实施过程开出工程实践的处方。要求开发者自觉保证，但XP对整个流程方法定义非常严格，规定需要采用TDD, 自动测试， 结对编程，简单设计，重构等约束团队的行为。因此，原作者认为， 这点上，XP的做法值得认同的，但是却把敏捷带入了一个让人困惑的矛盾, 因为xp的理念，结合敏捷模式，表达给团队的信息是“你是一个完全自我管理的组织， 但你必须要实现TDD, 结对编程, ...等等”

不难发现，这四个区别显见的是： Scrum非常突出Self-Orgnization, XP注重强有力的工程实践约束

### 持续集成
在开发的过程中，如何保证合入代码是有效呢？避免BUG的引入呢？因此需要做到以下几点：
* 在代码合入时，做好上库的门禁
* 及时对当前代码编译出版本，及时进行系统级别测试，反馈问题

集成软件的过程不是新问题，如果项目开发的规模比较小，比如一个人的项目，如果它对外部系统的依赖很小，那么软件集成不是问题，但是随着软件项目复杂度的增加（即使增加一个人），就会对集成和确保软件组件能够在一起工作提出了更多的要求-要早集成，常集成。早集成，频繁的集成帮助项目在早期发现项目风险和质量问题，如果到后期才发现这些问题，解决问题代价很大，很有可能导致项目延期或者项目失败。

大师Martin Fowler对持续集成是这样定义的:

持续集成是一种软件开发实践，即团队开发成员经常集成它们的工作，通常每个成员每天至少集成一次，也就意味着每天可能会发生多次集成。每次集成都通过自动化的构建（包括编译，发布，自动化测试)来验证，从而尽快地发现集成错误。许多团队发现这个过程可以大大减少集成的问题，让团队能够更快的开发内聚的软件。

#### 持续集成的意义
* 减少风险：一天中进行多次的集成，并做了相应的测试，这样有利于检查缺陷，了解软件的健康状况，减少假定。

* 减少重复过程：可以节省时间、费用和工作量。说起来简单，做起来难。这些浪费时间的重复劳动可能在我们的项目活动的任何一个环节发生，包括代码编译、数据库集成、测试、审查、部署及反馈。通过自动化的持续集成可以将这些重复的动作都变成自动化的，无需太多人工干预，让人们的时间更多的投入到动脑筋的、更高价值的事情上。

* 任何时间、任何地点生成可部署的软件：从外界来看，这是持续集成最明显的好处，我们可以对改进软件品质和减少风险说起来滔滔不绝，但对于客户来说，可以部署的软件产品是最实际的资产。利用持续集成，您可以经常对源代码进行一些小改动，并将这些改动和其他的代码进行集成。如果出现问题，项目成员马上就会被通知到，问题会第一时间被修复。不采用持续集成的情况下，这些问题有可能到交付前的集成测试的时候才发现，有可能会导致延迟发布产品，而在急于修复这些缺陷的时候又有可能引入新的缺陷，最终可能导致项目失败。

* 增强项目的可见性：持续集成让我们能够注意到趋势并进行有效的决策。如果没有真实或最新的数据提供支持，项目就会遇到麻烦，每个人都会提出他最好的猜测。通常，项目成员通过手工收集这些信息，增加了负担，也很耗时。持续集成可以带来两点积极效果：

    (1)有效决策：持续集成系统为项目构建状态和品质指标提供了及时的信息，有些持续集成系统可以报告功能完成度和缺陷率。

    (2)注意到趋势：由于经常集成，我们可以看到一些趋势，如构建成功或失败、总体品质以及其它的项目信息。

* 建立团队对开发产品的信心：持续集成可以建立开发团队对开发产品的信心，因为他们清楚的知道每一次构建的结果，他们知道他们对软件的改动造成了哪些影响，结果怎么样。

#### 持续集成的要点

1. 统一的代码库
2. 自动构建
3. 自动测试
4. 每个人每天都要向代码库主干提交代码
5. 每次代码递交后都会在持续集成服务器上触发一次构建
6. 保证快速构建
7. 模拟生产环境的自动测试
8. 每个人都可以很容易的获取最新可执行的应用程序
9. 每个人都清楚正在发生的状况
10. 自动化的部署

#### 持续集成的原则
1. 所有的开发人员需要在本地机器上做本地构建，然后再提交的版本控制库中，从而确保他们的变更不会导致持续集成失败。
2. 开发人员每天至少向版本控制库中提交一次代码。
3. 开发人员每天至少需要从版本控制库中更新一次代码到本地机器。
4. 需要有专门的集成服务器来执行集成构建,每天要执行多次构建。
5. 每次构建都要100%通过。
6. 每次构建都可以生成可发布的产品。
7. 修复失败的构建是优先级最高的事情。

